<html>
    <head>
        <script src="jquery-1.8.3.js"></script>
        <script src="jquery-ui-1.9.2.custom.js"></script>
        <link rel="stylesheet" type="text/css" href="dms.css">
        <link rel="stylesheet" type="text/css" href="jquery-ui-1.9.2.custom.css">

        <script type="text/javascript">
            $(document).ready(function(){
                $( "#dialog-modal" ).dialog({
                    autoOpen: false,
                    height: "auto",
                    width: "80%",
                    modal: true
                });
                $( "#supersedePanel" ).dialog({
                    autoOpen: false
                });
                loadDocuments();
            });

            function loadDocuments() {
                $.ajax({
                    url: "/dms/docs",
                    dataType: "json"
                }).success(function(html) {
                    createRows(html, "#results", true);
                    $('#results tbody tr:even').addClass('zebra');
                });
            }

            function createRows(response, table, includeLinks) {
                response.map(function(dto) {
                    var row = $("<tr />");
                    var doc = dto.document;
                    $("<td />").text(doc.documentNo).appendTo(row);
                    $("<td />").text(doc.title).appendTo(row);
                    $("<td />").text(doc.revision).appendTo(row);
                    if (includeLinks) {
                        var cell = $("<td />");
                        cell.appendTo(row);
                        var supersedeLink = dto.links.filter(function (element, index, array) { return (element.rel == "supersede"); });
                        if (supersedeLink.length > 0) {
                            cell.append($("<a href='javascript:showSupersede(&quot;" + doc.documentNo +
                                    "&quot;, &quot;" + doc.title + "&quot;, &quot;" + doc.revision + "&quot;, &quot;" + supersedeLink[0].uri + "&quot;);'>Supersede</a>"));
                        }
                        var historyLink = dto.links.filter(function (element, index, array) { return (element.rel == "history"); });
                        if (historyLink.length > 0) {
                            cell.append($("<a href='javascript:getHistory(&quot;" + historyLink[0].uri + "&quot;);'>History</a>"));
                        }
                    }
                    row.appendTo(table);
                });

            }

            function showSupersede(documentNo, title, revision, uri) {
                $("#documentNo").val(documentNo);
                $("#title").val(title);
                $("#revision").val(revision);
                $( "#supersedePanel" ).dialog({
                    height: "auto",
                    width: "50%",
                    modal: true,
                    buttons: {
                        "Supersede": function() {
                            supersedeDocuments(uri);
                        }
                    }
                });
                $("#supersedePanel").dialog("open");
            }

            function supersedeDocuments(uri) {
                $.ajax({
                    type: "PUT",
                    url: uri,
                    dataType: "json",
                    data: JSON.stringify({ "documentNo": $("#documentNo").val(), "title": $("#title").val(), "revision": $("#revision").val() })
                }).success(function(response) {
                });

            }

            function getHistory(uri) {
                $.ajax({
                    url: uri,
                    dataType: "json"
                }).success(function(response) {
                    $('#historyTable tbody tr:even').addClass('zebra');
                    createRows(response, "#historyTable", false);
                    $("#dialog-modal").dialog("open");
                });
            }

        </script>
    </head>
    <body>
        <br/>
        <table id="results">
            <tr><th>Document No.</th><th>Title</th><th>Revision</th><th>Actions</th></tr>
        </table>

        <div id="dialog-modal" title="Document History">
            <table id="historyTable">
                <tr><th>Document No.</th><th>Title</th><th>Revision</th></tr>
            </table>
        </div>

        <div id="supersedePanel" title="Supersede Document">
            <table id="supersedeTable">
                <table>
                    <tbody>
                        <tr>
                            <td>Document No.</td>
                            <td><input id="documentNo" type="text" size="20"/></td>
                        </tr>
                        <tr>
                            <td>Title</td>
                            <td><input id="title" type="text" size="50"/></td>
                        </tr>
                        <tr>
                            <td>Revision</td>
                            <td><input id="revision" type="text" size="5"/></td>
                        </tr>
                    </tbody>
                </table>
            </table>
        </div>

    </body>
</html>